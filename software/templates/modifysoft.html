{% load staticfiles %}
<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="butf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>CMS..修改软件资料</title>

        <script src="{% static 'bootstrap-3.3.7/js/jquery-1.11.3.min.js' %}"></script>
        <script src="{% static 'bootstrap-3.3.7/js/bootstrap.min.js' %}" type="text/javascript"></script>
        <link href="{% static 'bootstrap-3.3.7/css/bootstrap.min.css' %}" rel="stylesheet">
        <link href="{% static 'bootstrap-3.3.7/css/custom.css' %}" rel="stylesheet">
 	    <script src="{% static 'bootstrap-3.3.7/js/holder.js' %}"></script>
 	    <script src="{% static 'bootstrap-3.3.7/js/validator.min.js' %}"></script>
        <link href="{% static 'bootstrap-3.3.7/css/fileinput.css' %}" media="all" rel="stylesheet" type="text/css"/>
        <link href="{% static 'font-awesome-4.7.0/css/font-awesome.min.css' %}" media="all" rel="stylesheet" type="text/css"/>
        <link href="{% static 'bootstrap-3.3.7/themes/explorer-fa/theme.css' %}" media="all" rel="stylesheet" type="text/css"/>
        <script src="{% static 'bootstrap-3.3.7/js/plugins/sortable.js' %}" type="text/javascript"></script>
        <script src="{% static 'bootstrap-3.3.7/js/fileinput.js' %}" type="text/javascript"></script>
        <script src="{% static 'bootstrap-3.3.7/js/locales/zh.js' %}" type="text/javascript"></script>
        <script src="{% static 'bootstrap-3.3.7/themes/explorer-fa/theme.js' %}" type="text/javascript"></script>
        <script src="{% static 'bootstrap-3.3.7/themes/fa/theme.js' %}" type="text/javascript"></script>
        <script src="{% static 'bootstrap-3.3.7/js/popper.js' %}" type="text/javascript"></script>

        <script type="text/javascript">
         //点击增加软件分类,成功后将新的分类加入到下拉列表中
         $(function(){
             $("#addsofttype_btn").click(function()
                 {
                     var softtypename = $("#addsofttypename").val();
                     if (softtypename == ''){
                         alert("请输入软件分类名称！");
                         return;
                     }

                     $.post("/software/addsofttype/",
                            {
                                typename:$("#addsofttypename").val()
                            },
                            function(ret){
                                $("#showaddsofttypeinfo").html(ret.info);
                                var newflag = ret.newflag;
                                if (newflag == true)
                                    {
                                        $("#softselecttype").append("<option>"+$("#addsofttypename").val()+"</option>");
                                    }
                            });
                 });
         });


         //修改软件资料
         $(function(){
             $("#softsave_btn").click(function(){
                 if (($("#softname").val() == '') || ($("#softselecttype").val() == '') || ($("#softmemo").val().replace(/\ +/g,"") == '')){
                     alert('请填写好所有内容后再提交！');
                     return;
                 };

                 $.post("/software/addsoft/",
                        {
                            softid:$("#softid").val(),
                            softname:$("#softname").val(),
                            softtype:$("#softselecttype").val(),
                            softmemo:$("#softmemo").val()
                        },
                        function(ret){
                            $("#showaddsoftinfo_legend").html(ret.retinfo);
                            $("#softid").val(ret.softid);
                        });//post

             });//click
         });//ready

         //在加载完后填充数据，供修改
         $(function(){
             var softdict = {{softdict | safe}};
             $("#softid").val(softdict.softid);
             $("#softname").val(softdict.softname);
             $("#softselecttype").val(softdict.softtype);
             $("#softmemo").val(softdict.softdetial);
         });


         //删除一条软件的一个实际文件,传入ID
         function deleteonesoftfile(buttonitem){

             var isok;
             isok = confirm("是否真的要删除该软件？删除后无法恢复！");
             if (isok == false){
                 return;
             }
             var fileid = $(buttonitem).attr('value');
             $.post("/software/deleteonesoftfile/",{fileid:fileid},
                    function(ret){
                        alert(ret);
                    });
         };

         //删除一项软件资料（数据库及书籍附件）
         $(function(){
             $("#deleteonesoft_btn").click(function(){
                 var isok;
                 isok = confirm("是否确实删除该项软件所有资料，将删除该项所有已上传的软件？请确认！");
                 if (isok == false){
                     return;
                 }
                 $.post("/software/deleteonesoft/",
                        {softid:$("#softid").val()},
                        function(ret){
                            alert(ret);
                        }
                 );
             });
         });

        </script>

    </head>

    <body style="background: url({% static 'img/body00.jpg' %}" >

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
            <div class="container">

                <!-- Navbar links -->
                <div class="collapse navbar-collapse" id="navbar">
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="/home/">首页</a>
                        </li>
                        <li class="active">
                            <a href="/software/">返回</a>
                        </li>

                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container  导航头部 -->
        </nav>

        <div class="container-fluid">
	        <!-- 下面为显示区， -->
    	    <!-- 共两列 -->
            <div class="col-sm-1">
            </div>
		    <div class="col-sm-3">

			    <!-- List-Group Panel -->

                <div class="row">
                    <form class="form-horizontal" data-toggle="validator" role="form" method="post" >
                        <fieldset>
                            <div id="legend" class="">
                                <legend class="" id="showaddsofttypeinfo" name="addsofttypeinfo">
                                    增加软件类别
                                </legend>
                            </div>
                            <div class="control-group">
                                <label class="control-label" for="input01">类别名称</label>
                                <div class="controls">
                                    <input type="text" placeholder="请输入类别名称" class="form-control input-xlarge" id="addsofttypename" required
                                           data-bv-notempty-message="类别名称不能为空！" >
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <button type="button" class="btn btn-primary" id="addsofttype_btn">保存</button>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <hr><hr>
            </div> <!-- 左列 -->

            <div class="col-sm-1">
            </div>
		    <!-- Center Column 中间列，主显示区，占6格（一半）-->
		    <div class="col-sm-6">

			    <div class="row">
					<!-- 下面是增加图书资源form  -->
                    <form class="form-horizontal"  method ="post"  data-toggle="validator" role="form">
                        <fieldset>
                            <div id="legend" class="">
                                <legend class="" id="showaddsoftinfo_legend">
                                    增加软件资源
                                </legend>
                            </div>

                            <div class="control-group">
                                <div class="controls">
                                    <input type="text" class="form-control input-xlarge"  id="softid" readonly="readonly">
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label" for="input01">软件资源名称</label>
                                <div class="controls">
                                    <input type="text" placeholder="软件资源名称" class="form-control input-xlarge" id="softname" required>
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label">分类</label>
                                <div class="controls">
                                    <select class="form-control input-xlarge" id="softselecttype">
                                        {% for name in softtypelist%}
                                        <option>{{name}}</option>
                                        {%endfor%}
                                    </select>
                                </div>


                                <div class="control-group">
                                <label class="control-label">内容简介</label>
                                <div class="controls">
                                    <div class="textarea">
                                        <textarea type=""   style="height:300px" class="form-control" id="softmemo" required>
                                        </textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <button type="button" class="btn btn-primary" id="softsave_btn">保存</button>
                                    <button type="button" class="btn btn-primary" id="deleteonesoft_btn">删除</button>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <hr>
                <div class="row"> <!-- uloadfiles row -->
                    <form class="form-horizontal" method="post" enctype='multipart/form-data'>
                        <div class="controls">
                            <input type="file" class="file form-control"  id="files-my" name="files-my" multiple>
                        </div>
                    </form>
                </div> <!-- 上传文件ROW -->
                <script type="text/javascript">
                 $("#files-my").fileinput({
                     language: 'zh', //设置语言
                     theme: 'explorer-fa',
                     uploadUrl: "/software/uploadfiles/",
                     allowedFileExtensions: ['rar','zip','tar','gz','exe','bz','bz2'],//接收的文件后缀
                     uploadAsync: true, //默认异步上传
                     showUpload: true, //是否显示上传按钮
                     showRemove : false, //显示移除按钮
                     showPreview : true, //是否显示预览
                     showCaption: true,//是否显示标题
                     //browseClass: "btn btn-primary", //按钮样式
                     dropZoneEnabled: false,//是否显示拖拽区域
                     //minImageWidth: 50, //图片的最小宽度
                     //minImageHeight: 50,//图片的最小高度
                     //maxImageWidth: 1000,//图片的最大宽度
                     //maxImageHeight: 1000,//图片的最大高度
                     maxFileSize: 204800,//单位为kb，如果为0表示不限制文件大小 204800K = 200M
                     //minFileCount: 0,
                     maxFileCount: 10, //表示允许同时上传的最大文件个数
                     enctype: 'multipart/form-data',
                     validateInitialCount:true,
                     //previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
                     msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
                     uploadExtraData:function(previewId, index) {   //额外参数的关键点
                         return {'softid':$("#softid").val()};
                     }
                 });
                </script>


                <p>
                    <div id="legend" class="">
                        <font color="red"> 已上传软件文件</font>
                    </div>

                    <table id="tablefiles" class="table"> <!--  data-toggle="table" -->
                        <thead>
                            <tr>
                                <th>名称</th>
                                <th>大小</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for onefile in filelist %}
                            <tr>
                                <td><strong>{{onefile.filename}}</strong></td>
                                <td>{{onefile.filesize}}</td>
                                <td><button type='button' class='btn btn-danger btn-sm' value='{{onefile.fileid}}' onclick='deleteonesoftfile(this)'>删除</button></td>
                            </tr>
                            {%endfor%}
                        </tbody>
                    </table>


            </div>  <!-- 中间一列 -->

            <div class="col-sm-1">  <!-- right col space-1 -->
            </div>
  </div><!--/container-fluid-->


</body>

</html>
